<!DOCTYPE html>





<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="认识deck.gl来自官方的解释:  deck.gl的设计目的是简化大数据集的可视化。它使用户能够通过现有层的组合以有限的努力快速获得令人印象深刻的可视化结果，同时为将基于WebGL的高级可视化打包为可重用的JavaScript层提供了完整的体系结构。  简要概述: deck.gl的基本思想是渲染层的叠加 , 通常是渲染在地图上,但不总是; deck.gl面对的机遇与挑战:  处理大数据集和性能更">
<meta name="keywords" content="前端,js,jquery,javascript,html5,开发者,程序猿,程序媛,极客,编程,代码,开源,IT网站,Developer,Programmer,Coder,Geek,html,css,css3,用户体验">
<meta property="og:type" content="article">
<meta property="og:title" content="认识deck.gl">
<meta property="og:url" content="//likamoer.me/2019/08/20/deck-gl/index.html">
<meta property="og:site_name" content="小新没蜡笔的Blog">
<meta property="og:description" content="认识deck.gl来自官方的解释:  deck.gl的设计目的是简化大数据集的可视化。它使用户能够通过现有层的组合以有限的努力快速获得令人印象深刻的可视化结果，同时为将基于WebGL的高级可视化打包为可重用的JavaScript层提供了完整的体系结构。  简要概述: deck.gl的基本思想是渲染层的叠加 , 通常是渲染在地图上,但不总是; deck.gl面对的机遇与挑战:  处理大数据集和性能更">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-08-20T06:03:31.207Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="认识deck.gl">
<meta name="twitter:description" content="认识deck.gl来自官方的解释:  deck.gl的设计目的是简化大数据集的可视化。它使用户能够通过现有层的组合以有限的努力快速获得令人印象深刻的可视化结果，同时为将基于WebGL的高级可视化打包为可重用的JavaScript层提供了完整的体系结构。  简要概述: deck.gl的基本思想是渲染层的叠加 , 通常是渲染在地图上,但不总是; deck.gl面对的机遇与挑战:  处理大数据集和性能更">
  <link rel="alternate" href="/atom.xml" title="小新没蜡笔的Blog" type="application/atom+xml">
  <link rel="canonical" href="//likamoer.me/2019/08/20/deck-gl/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>认识deck.gl | 小新没蜡笔的Blog</title>
  <meta name="generator" content="Hexo 3.9.0">
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container">
    <div class="headband">
    <a href="https://github.com/likamoer"><img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小新没蜡笔的Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">遍历山河, 人间值得</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    

  <article class="post" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="//likamoer.me/2019/08/20/deck-gl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="likamoer">
      <meta itemprop="description" content="华中科技大学09级，就职于腾讯SNG。擅长各项前端技能，深入研究移动端开发与前端性能。非专业视觉设计师。此为博客一枚。">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小新没蜡笔的Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">认识deck.gl

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-08-20 14:01:35 / 修改时间：14:03:31" itemprop="dateCreated datePublished" datetime="2019-08-20T14:01:35+08:00">2019-08-20</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="认识deck-gl"><a href="#认识deck-gl" class="headerlink" title="认识deck.gl"></a>认识deck.gl</h2><p><em>来自官方的解释:</em></p>
<blockquote>
<p>deck.gl的设计目的是简化大数据集的可视化。它使用户能够通过现有层的组合以有限的努力快速获得令人印象深刻的可视化结果，同时为将基于WebGL的高级可视化打包为可重用的JavaScript层提供了完整的体系结构。</p>
</blockquote>
<p><em>简要概述:</em></p>
<p>deck.gl的基本思想是渲染层的叠加 , 通常是渲染在地图上,但不总是;</p>
<p>deck.gl面对的机遇与挑战:</p>
<ol>
<li>处理大数据集和性能更新优化;</li>
<li>交互式处理 例如拾取事件(picking);</li>
<li>地图投影和与基础地图的集成;</li>
<li>经过验证的、经过良好测试的层的目录;</li>
<li>易于创建新层或自定义现有层.</li>
</ol>
<p><em>生态系统:</em></p>
<p>deck.gl是vis.gl框架的主要框架之一;与许多框架进行并行开发,如下;</p>
<ul>
<li>luma.gl - 一个通用的WebGL库，旨在与原始的WebGL API和其他WebGL库(尽可能)互操作。特别是 , luma.gl不声明WebGL上下文的所有权，并且可以使用任何提供的上下文，包括应用程序或其他WebGL库创建的上下文;</li>
<li>react-map-gl - 一个React包装周围的Mapbox GL与deck.gl无缝工作(通俗点说就是mapbox-gl的react版本);</li>
<li>nebula.gl - 一个有着高性能的deck.gl的编辑框架;</li>
</ul>
<p><em>如何使用:</em></p>
<ol>
<li><p>安装: npm install deck.gl –save</p>
</li>
<li><p>也可以直接下载官方栗子:</p>
<p>git clone <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:uber/deck.gl.git</p>
<p>cd deck.gl/examples/…(你想看的栗子目录下)</p>
<p>npm install</p>
<p>npm start  —- (运行)</p>
<p>这样栗子就运行起来啦!!!</p>
</li>
</ol>
<p><em>纯js使用deck.gl:</em></p>
<ul>
<li><p>deck.gl的核心库和层对React或Mapbox gl没有依赖关系，可以被任何JavaScript应用程序使用。</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Deck&#125; <span class="keyword">from</span> <span class="string">'@deck.gl/core'</span>; <span class="comment">// 引入deck的核心模块</span></span><br><span class="line"><span class="keyword">import</span> &#123;GeoJsonLayer&#125; <span class="keyword">from</span> <span class="string">'@deck.gl/layers'</span>; <span class="comment">// 引入需要显示的层,有很多层,后续讲到</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// source: Natural Earth http://www.naturalearthdata.com/ via geojson.xyz</span></span><br><span class="line"><span class="keyword">const</span> GEOJSON =</span><br><span class="line">  <span class="string">'https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_110m_admin_1_states_provinces_shp.geojson'</span>; <span class="comment">// 要展示的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> INITIAL_VIEW_STATE = &#123;</span><br><span class="line">  latitude: <span class="number">40</span>, <span class="comment">// 经度</span></span><br><span class="line">  longitude: <span class="number">-100</span>, <span class="comment">// 纬度</span></span><br><span class="line">  zoom: <span class="number">3</span>, <span class="comment">// 缩放级别</span></span><br><span class="line">  bearing: <span class="number">30</span>, <span class="comment">// 轴承指数</span></span><br><span class="line">  pitch: <span class="number">30</span> <span class="comment">// 倾斜角度 0 - 90</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deck = <span class="keyword">new</span> Deck(&#123;</span><br><span class="line">  width: <span class="string">'100%'</span>, <span class="comment">// 设置deck范围</span></span><br><span class="line">  height: <span class="string">'100%'</span>, <span class="comment">// 高</span></span><br><span class="line">  initialViewState: INITIAL_VIEW_STATE, <span class="comment">// 定义初始化页面的deck在地图上的位置,视角</span></span><br><span class="line">  controller: <span class="literal">true</span>, <span class="comment">// 将控制器打开</span></span><br><span class="line">  layers: [ <span class="comment">// 需要显示的层</span></span><br><span class="line">    <span class="keyword">new</span> GeoJsonLayer(&#123; <span class="comment">// 将显示的层new出实例</span></span><br><span class="line">      data: GEOJSON, <span class="comment">// 展示的数据</span></span><br><span class="line">      stroked: <span class="literal">true</span>, <span class="comment">// 线</span></span><br><span class="line">      filled: <span class="literal">true</span>, <span class="comment">// 填充</span></span><br><span class="line">      lineWidthMinPixels: <span class="number">2</span>, <span class="comment">// 线的最小宽度</span></span><br><span class="line">      opacity: <span class="number">0.4</span>, <span class="comment">// 线的透明度</span></span><br><span class="line">      getLineColor: <span class="function"><span class="params">()</span> =&gt;</span> [<span class="number">255</span>, <span class="number">100</span>, <span class="number">100</span>], <span class="comment">// 设置线的颜色</span></span><br><span class="line">      getFillColor: <span class="function"><span class="params">()</span> =&gt;</span> [<span class="number">200</span>, <span class="number">160</span>, <span class="number">0</span>, <span class="number">180</span>] <span class="comment">// 设置填充的颜色</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// For automated test cases</span></span><br><span class="line"><span class="comment">/* global document */</span></span><br><span class="line"><span class="built_in">document</span>.body.style.margin = <span class="string">'0px'</span>;</span><br></pre></td></tr></table></figure>

<p>@deck.gl/core是deck的一个子模块 , 不包含任何响应依赖项的gl.</p>
</li>
<li><p>上面的代码实例就是使用一个纯js的deck.gl模块库的完整示例. es6的写法;</p>
</li>
<li><p>在script中如何引入?</p>
<script src="https://unpkg.com/deck.gl@latest/deckgl.min.js"></script>

<script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js"></script>

<link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css">

<p>不仅要引入deck.gl,而且还要引入mapbox-gl的js和css文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><em>结合React使用:</em></p>
<p>这也是官方推荐使用的方式;</p>
<p>虽然不是直接基于React, deck.gl从头设计到使用基于React的应用程序。deck.gl层自然适合React的组件渲染流和基于flux/redux的应用。当您重新运行您的正常JSX或React组件时，gl层将被高效地重新加载。</p>
<ul>
<li><p>结合React使用Deck.gl，只需导入DeckGL React组件，并将其作为另一个组件的子组件呈现，然后传入deck列表。deck.gl层作为属性。</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// app.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>; <span class="comment">// 结合React使用,先引入React</span></span><br><span class="line"><span class="keyword">import</span> DeckGL, &#123;LineLayer&#125; <span class="keyword">from</span> <span class="string">'deck.gl'</span>; <span class="comment">// 引入DeckGL 和需要使用的层</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Viewport settings</span></span><br><span class="line"><span class="comment">// 初始化的页面角度位置</span></span><br><span class="line"><span class="keyword">const</span> viewState = &#123;</span><br><span class="line">  longitude: <span class="number">-122.41669</span>, <span class="comment">// 经度</span></span><br><span class="line">  latitude: <span class="number">37.7853</span>, <span class="comment">// 纬度</span></span><br><span class="line">  zoom: <span class="number">13</span>, <span class="comment">// 缩放</span></span><br><span class="line">  pitch: <span class="number">0</span>, <span class="comment">// 倾斜角度</span></span><br><span class="line">  bearing: <span class="number">0</span> <span class="comment">// 轴承</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data to be used by the LineLayer</span></span><br><span class="line"><span class="comment">// 创建数据 源位置 --- 目标位置</span></span><br><span class="line"><span class="keyword">const</span> data = [&#123;<span class="attr">sourcePosition</span>: [<span class="number">-122.41669</span>, <span class="number">37.7853</span>], <span class="attr">targetPosition</span>: [<span class="number">-122.41669</span>, <span class="number">37.781</span>]&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// DeckGL react component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> layers = [</span><br><span class="line">      <span class="keyword">new</span> LineLayer(&#123;<span class="attr">id</span>: <span class="string">'line-layer'</span>, data&#125;) <span class="comment">// 初始化层</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;DeckGL viewState=&#123;viewState&#125; layers=&#123;layers&#125; /&gt; <span class="comment">// 设置组件</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>deck.gl的重要伙伴 —- react-map-gl。它是Mapbox的一个React包装器，可以共享相同的web mercator viewport设置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// app.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> DeckGL, &#123;LineLayer&#125; <span class="keyword">from</span> <span class="string">'deck.gl'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;StaticMap&#125; <span class="keyword">from</span> <span class="string">'react-map-gl'</span>; <span class="comment">// 引入react-map-gl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Set your mapbox access token here</span></span><br><span class="line"><span class="keyword">const</span> MAPBOX_ACCESS_TOKEN = <span class="string">'MAPBOX_ACCESS_TOKEN'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Initial viewport settings</span></span><br><span class="line"><span class="keyword">const</span> initialViewState = &#123;</span><br><span class="line">  longitude: <span class="number">-122.41669</span>,</span><br><span class="line">  latitude: <span class="number">37.7853</span>,</span><br><span class="line">  zoom: <span class="number">13</span>,</span><br><span class="line">  pitch: <span class="number">0</span>,</span><br><span class="line">  bearing: <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data to be used by the LineLayer</span></span><br><span class="line"><span class="keyword">const</span> data = [&#123;<span class="attr">sourcePosition</span>: [<span class="number">-122.41669</span>, <span class="number">37.7853</span>], <span class="attr">targetPosition</span>: [<span class="number">-122.41669</span>, <span class="number">37.781</span>]&#125;];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> layers = [</span><br><span class="line">      <span class="keyword">new</span> LineLayer(&#123;<span class="attr">id</span>: <span class="string">'line-layer'</span>, data&#125;)</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;DeckGL</span><br><span class="line">        initialViewState=&#123;initialViewState&#125;</span><br><span class="line">        controller=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">        layers=&#123;layers&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;StaticMap mapboxApiAccessToken=&#123;MAPBOX_ACCESS_TOKEN&#125; /&gt; ---- 在这加入react-map-gl的map组件</span><br><span class="line">      &lt;<span class="regexp">/DeckGL&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关于react-map-gl:</p>
<p>如示例中所示，DeckGL React组件作为React组件的子组件(如使用类似于deck的参数显示地图的React -map-gl)尤其有效。gl视口(即纬度，经度，缩放等)。在这个配置中，你的deck.gl层将在底层地图上呈现一个完全同步的地理空间覆盖。</p>
</li>
</ul>
<p><em>通过层可视化数据:</em></p>
<ol>
<li><p>渲染单个层</p>
<ul>
<li><p>deck.gl的设计允许您获取任何可以关联位置的数据，并使用deck轻松地在地图上呈现这些数据。关于deck.gl层,只需实例化该层的类，并传入一组属性，其中包括数据本身，以及该层用于构建可视化的一些访问器和属性;</p>
</li>
<li><p>属性是允许控制层如何呈现数据的值;</p>
</li>
<li><p>访问器是用来描述层应该如何提取各种值的函数。</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;DeckGL layers=&#123;[</span><br><span class="line">  <span class="keyword">new</span> ArcLayer(&#123;<span class="attr">data</span>: ...&#125;)</span><br><span class="line">]&#125; /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>渲染多个层</p>
<ul>
<li><p>deck.gl允许使用相同或不同的数据集呈现多个层。只需提供层实例和deck的数组。deck.gl将按顺序渲染它们(并处理悬停单击时的交互性等)。</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;DeckGL layers=&#123;[</span><br><span class="line">  <span class="keyword">new</span> PathLayer(&#123;<span class="attr">data</span>: ...&#125;),</span><br><span class="line">  <span class="keyword">new</span> LineLayer(&#123;<span class="attr">data</span>: ...&#125;),</span><br><span class="line">  <span class="keyword">new</span> ArcLayer(&#123;<span class="attr">data</span>: ...&#125;),</span><br><span class="line">]&#125; /&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<p><em>Deck.gl中主要的类:</em></p>
<ol>
<li><p>Deck</p>
<ul>
<li><input checked disabled type="checkbox"> <p>Deck是一个使用Deck的类。deck.gl层实例和viewport参数，将这些层呈现为透明覆盖，并处理事件;</p>
</li>
<li><input checked disabled type="checkbox"> <p>在使用React-map-gl中不需要此类的参加,而在纯js开发中,此类便是不可缺少的;</p>
</li>
<li><input checked disabled type="checkbox"> <p>怎么用?</p>
</li>
<li><input checked disabled type="checkbox"> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Basic standalone use</span></span><br><span class="line"><span class="keyword">import</span> &#123;Deck, ScatterplotLayer&#125; <span class="keyword">from</span> <span class="string">'deck.gl'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">viewState, data</span>) =&gt;</span> (</span><br><span class="line">  <span class="comment">// 创建一个新的Deck类 --- 生成一个画布</span></span><br><span class="line">  <span class="keyword">const</span> deck = <span class="keyword">new</span> Deck(&#123;</span><br><span class="line">	<span class="comment">// 加入层    </span></span><br><span class="line">    layers: [<span class="keyword">new</span> ScatterplotLayer(&#123;data&#125;)]</span><br><span class="line">  &#125;);</span><br><span class="line">  deck.setProps(&#123;viewState&#125;);</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Deck类的属性:</p>
<ol>
<li><p>width: 画布的宽(Number)</p>
</li>
<li><p>height: 画布的高(Number)</p>
</li>
<li><p>layers: 要渲染的层的集合 — 将要渲染的层放到一个数组里面,进行逐个渲染(Array)</p>
</li>
<li><p>layersFilter: 接收一个函数,函数的参数为layer, viewport, isPicking,用来过滤层,调整视口,控制是否发生拾取事件,所有层在渲染之前都会走这个函数,所以层的显隐可以在这里实现(Function: ({layers, viewport, isPicking}) =&gt; {….})</p>
</li>
<li><p>getCursor:  接收一个函数,来检索游标类型的自定义回调(Function: ({isDragging}) =&gt; isDragging ? ‘grabbing’ : ‘grab’)</p>
</li>
<li><p>views: 单个视图或视图实例的数组(可选地与Viewport实例混合，尽管后者是不推荐的)。如果没有提供，将创建一个MapView。如果提供了空数组，则不会显示任何视图。(Array)</p>
</li>
<li><p>viewState: 地理空间视图状态(Object)</p>
<ul>
<li><p>latitude: 经度(Number)</p>
</li>
<li><p>longitude: 纬度(Number)</p>
</li>
<li><p>zoom: 缩放程度(Number)</p>
</li>
<li><p>bearing: 轴承程度(Number)</p>
</li>
<li><p>pitch: 倾斜角度(Number: 0 - 90)</p>
<p>可以通过改变viewState的参数值来改变画布实例的角度位置</p>
</li>
</ul>
</li>
<li><p>initialViewState: 如果提供了initialViewState, Deck组件将使用内部状态跟踪来自任何附加控制器的视图状态更改，initialViewState作为其初始视图状态。(Object: 属性和viewState一样)</p>
</li>
<li><p>controller: 视窗互动选项，例如:平移，旋转和缩放与鼠标，触摸和键盘。如果使用默认视图(即单个MapView)，这是定义与视图道具交互的简写。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Deck(&#123;</span><br><span class="line">  ...</span><br><span class="line">  views: [<span class="keyword">new</span> MapView(&#123;<span class="attr">controller</span>: <span class="literal">true</span>&#125;)]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 上面写法和下面是一样的</span></span><br><span class="line"><span class="keyword">new</span> Deck(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// views: undefined</span></span><br><span class="line">  controller: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>其值有以下几种类型:</p>
<ul>
<li>null or false: 默认不启动控制器</li>
<li>true: 默认启动默认控制器</li>
<li>Controller: 使用默认选项启动所提供的控制器。必须是MapController的子类。</li>
<li>默认为null</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li><p>Deck类的配置属性:</p>
<ol>
<li>id(String): Canvas ID允许在CSS中定制样式;</li>
<li>style(Object): deckgl-canvas的Css样式;</li>
<li>pickingRadius(Number): 在选择时指针周围要包括的额外像素。当呈现的对象难以定位时，这是很有帮助的，例如不规则形状的图标、小的移动圆圈或触摸交互。默认为0。</li>
<li>useDevicePixels(Boolean):  如果为真，设备的全分辨率将用于渲染，这个值可以在每帧中改变，比如在屏幕之间移动窗口或改变浏览器的缩放级别。默认为真,但是一般都将其设置为false,因为这个会非常消耗性能,除非机器的性能足够高.</li>
<li>gl(Object): gl的上下文,如果不提供将会自动创建;</li>
</ol>
</li>
<li><p>Deck类的回调函数:</p>
<ol>
<li>onWebGLInitialized(Function: (gl) =&gt; {….})一旦webGL上下文被初始化,就会被调用;</li>
<li>onViewStateChange(Function: (viewState) -&gt; {….}): 当用户改变画布角度时调用.例如使用鼠标拖曳, 键盘控制等.</li>
<li>onLayerHover(Function: ): 当指针下的对象发生变化时调用。在鼠标悬浮在物体之上发生的回调;<ul>
<li>参数: info, pickedInfos, event</li>
<li>info: 在坐标中最顶层选择的info对象，在没有选择对象时为null;</li>
<li>pickedInfos: 所有受影响的可选层的信息对象数组。</li>
<li>event: 原始MouseEvent对象</li>
</ul>
</li>
<li>onLayerClick(Function): 当指针点击时发生的回调.参数同Hover回调</li>
<li>onDragStart, onDrag, onDragEnd(Function): 拖曳开始, 拖曳中, 拖曳结束<ul>
<li>参数: info, event 同Hover事件的参数</li>
</ul>
</li>
<li>onLoad(Function): 在创建gl上下文和Deck组件(ViewManager、LayerManager等)之后调用一次。可用于触发视口转换;</li>
</ol>
</li>
<li><p>Deck类的方法:</p>
<ol>
<li><p>finalize: 立即释放与此对象关联的资源(而不是等待垃圾收集)。</p>
<p>deck.finalize();</p>
</li>
<li><p>setProps: 更新属性.</p>
<p>deck.setProps({…..})</p>
</li>
<li><p>pickObject: 在给定的屏幕坐标上获取最近的可选可见对象.</p>
<p>deck.pickObject({x, y, radius, layerIds})</p>
<p>x: x位置(像素)</p>
<p>y: y位置(像素)</p>
<p>radius: 以像素为单位的公差半径</p>
<p>layerIds: 要查询的层id的列表。如果没有指定，则查询所有可选的和可见的层</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p>Layer:  Layer类是所有deck的基类。gl层，它提供了许多在所有层中可用的基本属性。</p>
<ul>
<li><p>静态成员</p>
<ol>
<li>layerName: 这个静态属性应该包含层的名称，通常是层的类的名称(不能在缩小的代码中可靠地自动推导)。它用作默认的层id以及调试和分析.</li>
<li>defaultProps: 所有deck.gl层定义一个defaultProps静态成员，列出它们的道具和默认值。在层实例构建过程中，使用defaultProps可以提高代码的可读性和性能。</li>
</ol>
</li>
<li><p>构造函数</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Layer(.<span class="built_in">..props</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>基础属性</p>
<ol>
<li>id(String): 静态属性 — 在给定的时间内，id必须在所有层之间是唯一的。id的默认值是层的“name”。如果一个特定层类型的多个实例同时存在，它们必须拥有deck的不同id字符串。gl来正确区分它们。</li>
<li>data(String|Iterable|Promise): deck.gl层通常期望数据支柱的值是一个JavaScript数组。也可以使用任何实现iterable协议的对象.数组,伪数组都可以.<ul>
<li>如果提供字符串，deck。gl将尝试将其作为URL加载，将其解析为JSON，然后使用预期的结果JavaScript数组作为其数据支柱</li>
<li>如果是Promise函数，deck.gl将使用resolve解析值作为其数据支柱。</li>
</ul>
</li>
<li>visible(Boolean): 层是否可见。在大多数情况下，建议使用可见道具来控制图层的可见性，而不是使用条件渲染</li>
<li>opacity(Number): 图层的不透明度;</li>
</ol>
</li>
<li><p>交互属性</p>
<ol>
<li><p>pickable(Boolean, default: false): 层是否响应鼠标指针选择事件。</p>
</li>
<li><p>onHover(Function): 当鼠标进入/离开此deck.gl层的对象时，将调用此回调,具有以下参数:</p>
<ul>
<li>info: 此时鼠标下的信息</li>
<li>event: 事件对象</li>
</ul>
</li>
<li><p>onClick(Function): 当鼠标点击此deck.gl层的对象时,将调用此回调,具有以下参数: 同onHover</p>
</li>
<li><p>onDragStart, onDrag, onDragEnd同Deck回调事件;</p>
</li>
<li><p>highlightColor(Array, [0, 0, 128, 128])</p>
<ul>
<li>RGBA颜色用于渲染突出显示的对象。当指定3 component (RGB)数组时，alpha使用默认值255。</li>
</ul>
</li>
<li><p>highlightedObjectIndex(Integer, -1)</p>
<ul>
<li>当提供一个有效值时，对应的对象(实例渲染中的一个实例或具有相同拾取颜色的一组原语)将使用highlightColor高亮显示。</li>
</ul>
</li>
<li><p>autoHighLight(Boolean, false)</p>
<ul>
<li><p>当为true时，鼠标指针指向的当前对象(悬停在其上时)用highlightColor高亮显示。</p>
<p>要求picable为真。</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p>坐标系统的属性 —- 通常只在应用程序希望使用非Web Mercator投影经纬度的坐标时使用</p>
<ol>
<li>coordinateSystem(Number): 指定如何对层位置和偏移量进行地理解释。</li>
<li>coordinateOrigin([Number, Number]): 将coordinateSystem设置为coordinate_system . meter_offset时需要。</li>
<li>wrapLongitude(Boolean, false): 自动将纵向缠绕在第180个反物质上，以获得当前视区的最佳可视性。</li>
<li>modelMatrix(Number[16]):一个可选的4x4矩阵，它被乘进着色器项目GLSL函数和Viewport的项目和非项目JavaScript函数使用的仿射投影矩阵</li>
</ol>
</li>
<li><p>数据属性</p>
<ol>
<li>dataComparator(Function): 这个支持使用自定义比较函数对数据支持进行比较。使用旧数据和新数据对象调用compare函数，如果它们进行相等的比较，则期望返回true。</li>
<li>numInstances(Number): deck.gl通过计算数据中对象的数量，自动从数据支柱中获取绘图实例的数量。但是，开发人员可能希望使用此道具手动覆盖它。</li>
<li>updateTriggers(Object): 调用getColor和getPosition等访问器来检索第一次添加层时的颜色和位置。从那以后，为了最大化性能，deck。gl不会重新计算颜色或位置，除非通过浅比较更改数据支柱。</li>
</ol>
</li>
</ul>
</li>
<li><p>其他衍生Layer层的实例</p>
<ol>
<li>ArcLayer: 弧线层呈现向上的弧线，连接源点和目标点对，指定为纬度/经度坐标。</li>
</ol>
<ul>
<li><p>怎么使用?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DeckGL, &#123;ArcLayer&#125; <span class="keyword">from</span> <span class="string">'deck.gl'</span>;</span><br><span class="line"><span class="comment">// 从deck.gl里面引出弧线层类</span></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">&#123;data, viewport&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// 拿到数据,匹配格式</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Data format:</span></span><br><span class="line"><span class="comment">   * [</span></span><br><span class="line"><span class="comment">   *   &#123;</span></span><br><span class="line"><span class="comment">   *     inbound: 72633,</span></span><br><span class="line"><span class="comment">   *     outbound: 74735,</span></span><br><span class="line"><span class="comment">   *     from: &#123;</span></span><br><span class="line"><span class="comment">   *       name: '19th St. Oakland (19TH)',</span></span><br><span class="line"><span class="comment">   *       coordinates: [-122.269029, 37.80787]</span></span><br><span class="line"><span class="comment">   *     &#125;,</span></span><br><span class="line"><span class="comment">   *     to: &#123;</span></span><br><span class="line"><span class="comment">   *       name: '12th St. Oakland City Center (12TH)',</span></span><br><span class="line"><span class="comment">   *       coordinates: [-122.271604, 37.803664]</span></span><br><span class="line"><span class="comment">   *   &#125;,</span></span><br><span class="line"><span class="comment">   *   ...</span></span><br><span class="line"><span class="comment">   * ]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    <span class="comment">// 创建弧线层实例</span></span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> ArcLayer(&#123;</span><br><span class="line">    id: <span class="string">'arc-layer'</span>, <span class="comment">// 定义名称 -- 方便之后更容易找到此层并操作</span></span><br><span class="line">    data, <span class="comment">// 加载数据</span></span><br><span class="line">    pickable: <span class="literal">true</span>, <span class="comment">// 允许发生拾取事件</span></span><br><span class="line">    getStrokeWidth: <span class="number">12</span>, <span class="comment">// 设置弧线的宽度</span></span><br><span class="line">    getSourcePosition: <span class="function"><span class="params">d</span> =&gt;</span> d.from.coordinates, <span class="comment">// 设置来源点的位置</span></span><br><span class="line">    getTargetPosition: <span class="function"><span class="params">d</span> =&gt;</span> d.to.coordinates, <span class="comment">// 设置目标点的位置</span></span><br><span class="line">    getSourceColor: <span class="function"><span class="params">d</span> =&gt;</span> [<span class="built_in">Math</span>.sqrt(d.inbound), <span class="number">140</span>, <span class="number">0</span>], <span class="comment">// 设置弧线来源点一边的弧线颜色</span></span><br><span class="line">    getTargetColor: <span class="function"><span class="params">d</span> =&gt;</span> [<span class="built_in">Math</span>.sqrt(d.outbound), <span class="number">140</span>, <span class="number">0</span>], <span class="comment">// 设置弧线目标点的弧线颜色</span></span><br><span class="line">    onHover: <span class="function">(<span class="params">&#123;object, x, y&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> tooltip = <span class="string">`<span class="subst">$&#123;object.<span class="keyword">from</span>.name&#125;</span> to <span class="subst">$&#123;object.to.name&#125;</span>`</span>; <span class="comment">// 在鼠标悬浮的时候产生的回调函数</span></span><br><span class="line">      <span class="comment">/* Update tooltip</span></span><br><span class="line"><span class="comment">         http://deck.gl/#/documentation/developer-guide/adding-interactivity?					section=example-display-a-tooltip-for-hovered-object</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">DeckGL</span> &#123;<span class="attr">...viewport</span>&#125; <span class="attr">layers</span>=<span class="string">&#123;[layer]&#125;</span> /&gt;</span>); // 最后在组件中渲染该层实例</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>属性: 从所有的基础层类(Layer)继承属性.</p>
</li>
<li><p>渲染时的配置项:</p>
<ol>
<li>fp64(Boolean, false): 是否应该在高精度64位模式下渲染该层。注意自deck.gl v6.1，默认的32位投影使用一种混合模式，这种模式与64位精度匹配，性能显著提高.</li>
<li>widthScale(Number, 1): 每个弧的宽度的比例因子。如果将属性设置为Math.pow(2,viewport.zoom - 12)宽度保持不变，对应当前的zoom level和zoom level 12时1像素的宽度。还可以使用此属性限制弧的最小大小宽度.</li>
</ol>
</li>
<li><p>数据访存器:</p>
<ol>
<li><p>getSourcePosition(Function): 方法 — 来检索每个对象的源位置。</p>
</li>
<li><p>getTargetPosition(Function): 方法 — 来检索每个对象的目的位置.</p>
</li>
<li><p>getSourceColor(Function|Array, [0, 0, 0, 255]): 方法 — 检索位置颜色.</p>
<ul>
<li>如果是Array,直接返回数组里面的rgba颜色值</li>
<li>如果是Function函数值, 该函数返回一个rgba的数组值.</li>
</ul>
</li>
<li><p>getTargetColor(Function|Array, [0, 0, 0, 255]): 方法 — 检索位置颜色.</p>
<ul>
<li>同上</li>
</ul>
</li>
<li><p>getStrokeWidth(Function|Number, 1): 每个对象的笔画宽度，以像素为单位。</p>
<ul>
<li><p>如果提供了数字，则将其用作所有对象的笔划宽度.</p>
</li>
<li><p>如果提供了函数，则对每个对象调用该函数以检索其笔划宽度。</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>2.GeoJsonLayer: GeoJson层接收GeoJson格式的数据，并将其呈现为交互式的多边形、线和点。</p>
<ul>
<li><p>怎么使用?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DeckGL, &#123;GeoJsonLayer&#125; <span class="keyword">from</span> <span class="string">'deck.gl'</span>;</span><br><span class="line"><span class="comment">// 用法和创建和之前的栗子差不多,只是渲染时的一些属性不同</span></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">&#123;data, viewport&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;data, viewport&#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Data format:</span></span><br><span class="line"><span class="comment">   * Valid GeoJSON object</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> GeoJsonLayer(&#123;</span><br><span class="line">    id: <span class="string">'geojson-layer'</span>,</span><br><span class="line">    data,</span><br><span class="line">    pickable: <span class="literal">true</span>,</span><br><span class="line">    stroked: <span class="literal">false</span>,</span><br><span class="line">    filled: <span class="literal">true</span>,</span><br><span class="line">    extruded: <span class="literal">true</span>,</span><br><span class="line">    lineWidthScale: <span class="number">20</span>,</span><br><span class="line">    lineWidthMinPixels: <span class="number">2</span>,</span><br><span class="line">    getFillColor: [<span class="number">160</span>, <span class="number">160</span>, <span class="number">180</span>, <span class="number">200</span>],</span><br><span class="line">    getLineColor: <span class="function"><span class="params">d</span> =&gt;</span> colorToRGBArray(d.properties.color),</span><br><span class="line">    getRadius: <span class="number">100</span>,</span><br><span class="line">    getLineWidth: <span class="number">1</span>,</span><br><span class="line">    getElevation: <span class="number">30</span>,</span><br><span class="line">    onHover: <span class="function">(<span class="params">&#123;object, x, y&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> tooltip = object.properties.name || object.properties.station;</span><br><span class="line">      <span class="comment">/* Update tooltip</span></span><br><span class="line"><span class="comment">         http://deck.gl/#/documentation/developer-guide/adding-interactivity?section=example-display-a-tooltip-for-hovered-object</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">DeckGL</span> &#123;<span class="attr">...viewport</span>&#125; <span class="attr">layers</span>=<span class="string">&#123;[layer]&#125;</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>渲染属性: 从所有基层属性继承而来的数据支柱被稍微灵活地解释了一下，以适应纯粹的GeoJson“有效负载”。</p>
<ol>
<li>filled(Boolean, true): 是否绘制填充多边形(实体填充)。注意，对于每个多边形，只有外部多边形和任何孔之间的区域将被填充。这个道具只有在多边形没有被挤压的情况下才有效。</li>
<li>stroked(Boolean, false): 是否绘制多边形的轮廓(固体填充)。注意，对于复杂的多边形，将绘制外部多边形以及任何孔的轮廓。</li>
<li>extruded(Boolean, false): 如果设置为true，沿z轴挤压多边形和多多边形特征。绘制的特征的高度是通过getElevation访问器获得的。</li>
<li>wireframe(boolean, false): 是否生成六边形的线框。轮廓将有“水平”线关闭的顶部和底部多边形和垂直线(“支柱”)的每个顶点的多边形.<ul>
<li>只有当extruded设置为true是才有效</li>
</ul>
</li>
<li>lineWidthScale(Boolean, 1): 行宽乘法器，用于乘到所有行，包括LineString和MultiLineString特性，如果描边属性为真，还包括多边形和多多边形特性的轮廓。</li>
<li>lineWidthMinPixels(Number, 0): 最小行宽，以像素为单位。</li>
<li>lineWidthMaxPixels(Number, Number.MAX_SAFE_INTEGER): 最大行宽, 像素为单位</li>
<li>lineJointRounded(Boolean, false): 两条geo线连接重叠部分的样式.</li>
<li>lineMiterLimit(Number, 4): 一个l连接点的最大宽度与行宽度之比。只有当linejointround为假时才有效.</li>
<li>elevationScale(Number, 1): 海拔乘数。最终高程按海拔比例尺* getElevation(d)计算。elevationScale是一个处理的属性，可以在不更新数据的情况下缩放所有多边形的高程。</li>
<li>pointRadiusScale(Numbel, 1): 所有点的全局半径乘法器。</li>
</ol>
</li>
<li><p>数据访问器</p>
<ol>
<li>getLineColor(Function|Array, [0, 0,0,255]): 根据GeoJson特性的类型，行字符串的rgba颜色和/或多边形的轮廓。格式为r, g, b， [a]。每个组件都在0-255范围内。</li>
<li>gitFillColor(Function|Array, [0,0,0,255]): GeoJson的多边形和点特征的纯色。格式为r, g, b， [a]。每个组件都在0-255范围内。</li>
<li>getRadius(Function|Number): 点的半径和多点特征，以米为单位。</li>
<li>getLineWidth(Function|Number): 根据GeoJson特性的类型，行字符串的宽度和/或多边形的轮廓。单位是米。</li>
<li>getElevation(Function|Number): 多边形特征的高程(挤压时为真)。</li>
</ol>
</li>
</ul>
<ol start="3">
<li><p>HexagonLayer</p>
<ul>
<li><p>六边形层根据点数组呈现一个六边形热图。它取六边形仓的半径，投影到六边形仓中。六边形的颜色和高度由它包含的点的数量来决定。</p>
</li>
<li><p>怎么使用?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> DeckGL, &#123;HexagonLayer&#125; <span class="keyword">from</span> <span class="string">'deck.gl'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">&#123;data, viewport&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Data format:</span></span><br><span class="line"><span class="comment">   * [</span></span><br><span class="line"><span class="comment">   *   &#123;COORDINATES: [-122.42177834, 37.78346622]&#125;,</span></span><br><span class="line"><span class="comment">   *   ...</span></span><br><span class="line"><span class="comment">   * ]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> layer = <span class="keyword">new</span> HexagonLayer(&#123;</span><br><span class="line">    id: <span class="string">'hexagon-layer'</span>,</span><br><span class="line">    data,</span><br><span class="line">    pickable: <span class="literal">true</span>,</span><br><span class="line">    extruded: <span class="literal">true</span>,</span><br><span class="line">    radius: <span class="number">200</span>,</span><br><span class="line">    elevationScale: <span class="number">4</span>,</span><br><span class="line">    getPosition: <span class="function"><span class="params">d</span> =&gt;</span> d.COORDINATES,</span><br><span class="line">    onHover: <span class="function">(<span class="params">&#123;object, x, y&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> tooltip = <span class="string">`<span class="subst">$&#123;object.centroid.join(<span class="string">', '</span>)&#125;</span>\nCount: <span class="subst">$&#123;object.points.length&#125;</span>`</span>;</span><br><span class="line">      <span class="comment">/* Update tooltip</span></span><br><span class="line"><span class="comment">         http://deck.gl/#/documentation/developer-guide/adding-interactivity?section=example-display-a-tooltip-for-hovered-object</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">DeckGL</span> &#123;<span class="attr">...viewport</span>&#125; <span class="attr">layers</span>=<span class="string">&#123;[layer]&#125;</span> /&gt;</span>);</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>渲染属性</p>
<ol>
<li>radius(Number, 1000): 六角形料斗半径(米)。六边形是尖顶的(而不是平顶的)。</li>
<li>hexagonAggregator(Function, d3-hexbin): 六边形聚合器是将数据聚合到六边形容器中的函数。六边形聚合器将层的道具和当前视图作为参数。输出应该是{六边形:[]，六边形顶点:[]}。六边形是{centroid: []， points:[]}的数组，其中centroid是六边形的中心，points是六边形包含的点的数组。六边形顶点(可选)是定义基本六边形几何形状的点数组.</li>
<li>colorRange(Array): 颜色值数组,用来创建六边形因密度不同而形成的颜色区分;</li>
<li>coverage(Number): 六角半径乘法器，夹在0 - 1之间。六边形的最终半径是用覆盖率*半径来计算的。注意:覆盖率不影响点的绑定方式。容器的半径仅由半径属性决定。</li>
<li>elevationDomain(Array, [0, Max(count)]):  高程刻度输入域。高程比例尺是一种线性比例尺，它将计数的数量映射到高程。默认情况下，它被设置为在每个六边形的点计数的0到最大值之间。当您希望使用相同的高程比例呈现不同的数据输入以进行比较时，此属性非常方便。</li>
<li>elevationRange(Array, [0, 1000]): 高程刻度输出范围</li>
<li>elevationScale(Number, 1): 六角海拔乘数。实际高程按elevationScale* getElevation(d)计算。elevationScale是一个方便的属性，可以在不更新数据的情况下缩放所有六边形.</li>
<li>extruded(Boolean, false): 是否启用单元格提升。单元格高程按每个单元格中的点数计算。如果设置为false，则所有单元格都是扁平的。</li>
<li>upperPercentile(Number, 100):  过滤箱和重新计算颜色的上位百分比。颜色值大于上百分位的六边形将被隐藏(控制数据量密度的值,值越大,密度要更大才能更好的区分)</li>
<li>lowerPercentile(Number, 0): 过滤箱和重新计算颜色的较低百分位。颜色值小于最小百分位数的六边形将被隐藏。(密度控制阀, 越低,密度越低的颜色有区分)</li>
<li>elevationUpperPercentile(Number, 100): 过滤箱和重新计算海拔高度的海拔上百分位。高程值大于上百分位的六边形将被隐藏</li>
<li>elevationLowerPercentile(Number, 0): 过滤箱和重新计算海拔高度由海拔低百分位。标高小于标高的六边形将被隐藏。</li>
<li>lightSettings(Object): 这个对象包含挤压多边形的灯光设置。请注意，这个道具可能会在deck.gl的未来版本中更改.</li>
</ol>
</li>
<li><p>数据访问器</p>
<ol>
<li><p>getPosition(Function): 方法来检索每个点的位置。</p>
</li>
<li><p>getColorValue(Function): getColorValue是获取bin color所基于的值的访问器函数。它将每个bin中的点数组作为参数，返回一个数字。例如，可以通过每个点的特定属性的avg/mean/max，将getColorValue传递给颜色容器。默认情况下，getColorValue返回点数组的长度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHexagonLayer</span> </span>&#123;</span><br><span class="line">   getColorValue (points) &#123;</span><br><span class="line">       <span class="keyword">return</span> points.length;</span><br><span class="line">   &#125;</span><br><span class="line">           </span><br><span class="line">   renderLayers() &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> HexagonLayer(&#123;</span><br><span class="line">       id: <span class="string">'hexagon-layer'</span>,</span><br><span class="line">       getColorValue: <span class="keyword">this</span>.getColorValue <span class="comment">// instead of getColorValue: (points) =&gt; &#123; return points.length; &#125;</span></span><br><span class="line">       data,</span><br><span class="line">       radius: <span class="number">500</span></span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>getElevationValue(Function): 类似于getColorValue, getElevationValue是获取bin elevation所基于的值的访问器函数。它将每个bin中的点数组作为参数，返回一个数字。默认情况下，getElevationValue返回点数组的长度</p>
</li>
<li><p>onSetColorDomain(Function): 计算bin颜色域时将调用此回调。</p>
</li>
<li><p>onSetElevationDomain(Function): 当bin海拔域计算完成时，将调用此回调。</p>
</li>
</ol>
</li>
</ul>
<p>注: 还有其他layer层的类,可以去官网上阅读,其实每个层的类的用法都一样,只是,每个层有其不一样的属性,结合不一样的属性创建不一样的动画,或者物体.</p>
</li>
</ol>
</li>
<li><p>shader modules — 着色器模块 —请自行查询官网</p>
</li>
</ol>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/08/20/hello-world/" rel="next" title="开始我的博客之旅">
                  <i class="fa fa-chevron-left"></i> 开始我的博客之旅
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/08/20/mapbox/" rel="prev" title="认识mapbox-g">
                  认识mapbox-g <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.png"
      alt="likamoer">
  <p class="site-author-name" itemprop="name">likamoer</p>
  <div class="site-description motion-element" itemprop="description">华中科技大学09级，就职于腾讯SNG。擅长各项前端技能，深入研究移动端开发与前端性能。非专业视觉设计师。此为博客一枚。</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://juejin.im/user/5a3bb0c0f265da43085e33b1" title="Juejin &rarr; https://juejin.im/user/5a3bb0c0f265da43085e33b1" rel="noopener" target="_blank"><i class="fa fa-fw fa-legal"></i>Juejin</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/likamoer" title="GitHub &rarr; https://github.com/likamoer" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:li_hx214@163.com" title="E-Mail &rarr; mailto:li_hx214@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>




        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#认识deck-gl"><span class="nav-number">1.</span> <span class="nav-text">认识deck.gl</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">likamoer</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        <span>0%</span>
      </div>

    

  </div>

  
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>
<script src="/js/schemes/muse.js?v=7.3.0"></script>
<script src="/js/next-boot.js?v=7.3.0"></script>



  


























  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script><script src="/js/post-details.js?v=7.3.0"></script>


</body>
</html>
